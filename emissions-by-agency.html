<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>US Government Greenhouse Gas Emissions</title>
  <style>
    body {background-color:#fff; font:12px sans-serif;}
    footer {margin-top:2em;}
  </style>
</head>
<body>
  <div id="page" class="container">
    <h1><a href="/">US Government Greenhouse Gas Emissions</a></h1>
    <h2>Emissions by Agency</h2>
    <select id="metric-selector">
      <option value="ghg" selected="true">Greenhouse Gas Emissions (GHG)</option>
      <option value="vehicles">Vehicles</option>
      <!--option value="ghg_per_vehicle" >Greenhouse Gas Emissions (GHG) per Vehicle</option-->
    </select>
    <div id="chart-container"></div>
    <footer>
      <a href="http://s2t2.github.io/gsa-hackathon-2015/">view</a> |
      <a href="https://github.com/s2t2/gsa-hackathon-2015">source</a>
    </footer>
  </div>

  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="http://code.highcharts.com/highcharts.js"></script>
  <script>

    var metricSelector = document.getElementById("metric-selector")
    metricSelector.addEventListener("change", updateChart, false);

    var zz;
    var chart //= new Highcharts.Chart
    function updateChart(){
      var metric_abbrev = metricSelector.value
      var metric_title = metricSelector.options[metricSelector.selectedIndex].innerHTML
      console.log(metric_title)

      var sort_variable
      switch (metric_abbrev) {
        case "ghg":
          sort_variable = "GHG_TOTAL"
          break;
        case "vehicles":
          sort_variable = "VEHCNT_TOTAL"
          break;
        //case "ghg_per_vehicle":
        //  sort_variable = "GHG_PER_VEH_TOTAL"
        //  break;
      };

      d3.csv("data/ghg/emissions_by_agency.csv", function(rows){
          zz = rows

          var sorted_rows = rows.sort(function(a, b){
            return d3.descending(a[sort_variable], b[sort_variable]);
          })

          //
          // MANIPULATE DATA
          //

          var chart_categories = sorted_rows.map(function(r){
            return r.agyName + ' (' + r.agyAbbrev + ')'
          }) // ['Agency1', 'Agency2', 'Agency3', 'Agency4', 'Agency5']






          var horizontal_axis_title = metric_title // 'Greenhouse Gas Emissions (GHG)'
          var chart_series = [
            {
              name: 'E85 Vehicles',
              data: [
                5, // agency 1 GHG
                3, // agency2 GHG
                4, // agency3 GHG
                7, // agency4 GHG
                2 // agency5 GHG
              ]
            },
            {
              name: 'Gas Vehicles',
              data: [2, 2, 3, 2, 1]
            },
            {
              name: 'Other Vehicles (Diesel, Biodiesel, B20, Electric)',
              data: [3, 4, 4, 2, 5]
            }
          ]

          //
          // PLOT DATA
          //

          $('#chart-container').highcharts({
              chart: {
                  type: 'bar'
              },
              title: {
                  text: '',
                  style: {
                      display: 'none'
                  }
              },
              xAxis: {
                  categories: chart_categories
              },
              yAxis: {
                  min: 0,
                  title: {
                      text: horizontal_axis_title
                  }
              },
              legend: {
                  reversed: true
              },
              plotOptions: {
                  series: {
                      stacking: 'normal'
                  }
              },
              series: chart_series
          }); // highcharts


      }); // d3.json

    }; // updateChart

    updateChart()

  </script>
</body>
</html>
